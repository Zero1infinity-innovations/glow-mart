var app = angular.module("paginationApp", [
    "angularUtils.directives.dirPagination",
]);


app.controller("paginationController", function ($scope, $http, $location) {
    var baseUrl = $location.absUrl();
    $scope.users = [];
    $scope.totalUsers = 0;
    $scope.usersPerPage = "10";
    $scope.q = "";

    var stringData = baseUrl.indexOf("?");
    var stringValue = stringData === -1 ? "?" : "&";

    $scope.shortData = function shortData(columnName, clickedElement) {
        var thElements = document.querySelectorAll("#thead-html th");

        alert(columnName);
        console.log(clickedElement);

    };

    function getResultsPage(pageNumber) {
        $scope.showPreloader = true;
        $http
            .get(baseUrl + stringValue + "true", {
                params: {
                    page: pageNumber,
                    searchFilter: $scope.q,
                    pageLimit: $scope.usersPerPage,
                },
            })
            .then(function (result) {
                $scope.users = result.data.data;
                $scope.totalUsers = result.data.total;
                $scope.showPreloader = false;
                $scope.pageNumber = pageNumber;
            })
            .catch(function (error) {
                console.error("Error fetching data:", error);
            });
    }

    $scope.getSerialNumber = function (index) {
        return index + 1 + ($scope.pageNumber - 1) * $scope.usersPerPage;
    };

    $scope.updatePerPage = function () {
        getResultsPage(1);
    };

    $scope.searchFilter = function () {
        getResultsPage(1);
    };

    $scope.pageChanged = function (newPage) {
        getResultsPage(newPage);
    };

    getResultsPage(1);

    // start ajax modal
    $scope.sendObj = function (obj) {
        var formData = new FormData();
        for (var key in obj) {
            if (obj.hasOwnProperty(key)) {
                formData.append(key, obj[key]);
            }
        }
        return formData;
    };

    $scope.callAjax = function (url, data, callback, method = "POST") {
        const xhr = new XMLHttpRequest();
        xhr.open(method, url, true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    const responseText = xhr.responseText;
                    callback(responseText);
                } else {
                    alert(xhr.status);
                }
            }
        };
        xhr.send(data);
    };

    $scope.ajaxModal = function (url, data, modalType = "", method = "POST") {
        $scope.callAjax(
            url,
            data,
            function (responseText) {
                $("#basicModal").modal("show");
                if (modalType) {
                    document
                        .getElementById("ajaxModalClass")
                        .classList.add(modalType);
                }
                document.getElementById("ajax_response").innerHTML =
                    responseText;
            },
            method
        );
    };



    $scope.copyText = function (text) {
        navigator.clipboard.writeText(text);
        alert(text);
    };



    $scope.customeJsonParser = function (data) {
        console.log(data);
        return JSON.parse(data);
    };
});
